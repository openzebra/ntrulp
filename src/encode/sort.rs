pub fn min_max<const SIZE: usize>(arr: &mut [i32; SIZE], x: usize, y: usize) {
    if arr[y] < arr[x] {
        arr.swap(x, y);
    }
}

pub fn crypto_sort_i32<const SIZE: usize>(x: &mut [i32; SIZE]) {
    if SIZE < 2 {
        return;
    }

    let mut top = 1;
    while top < (SIZE - top) {
        top += top;
    }
    let mut p = top;
    while p > 0 {
        for i in 0..(SIZE - p) {
            if i & p == 0 {
                min_max::<SIZE>(x, i, i + p)
            }
        }
        let mut q = top;
        while q > p {
            for i in 0..(SIZE - q) {
                if i & p == 0 {
                    min_max::<SIZE>(x, i + p, i + q)
                }
            }
            q >>= 1;
        }
        p >>= 1;
    }
}

pub fn crypto_sort_u32<const SIZE: usize>(x: &mut [u32; SIZE]) {
    let mut i32_x = [0i32; SIZE];

    for i in 0..SIZE {
        i32_x[i] = x[i] as i32;
    }

    crypto_sort_i32(&mut i32_x);

    for i in 0..SIZE {
        x[i] = i32_x[i] as u32;
    }
}

#[test]
fn test_crypto_sort_u32() {
    let mut seed: [u32; 100] = [
        138239789, 1702227250, 3498447549, 1186908429, 440488066, 3037598569, 1571153962,
        732541564, 2838386626, 3794103935, 4017187193, 1035446042, 326114568, 2012121537,
        1475375200, 3595573699, 2574438453, 822844072, 3780371269, 4213561102, 3915466775,
        2501594143, 1052986081, 3034284197, 2988878015, 1585907552, 1468014272, 3839796493,
        1909929013, 1075827061, 3009571896, 367884623, 1757583649, 2411221485, 1551077402,
        2746176948, 1011162928, 2343005761, 3017216762, 3470621498, 3469043655, 3283210540,
        4142653423, 607688268, 2907501882, 2091507055, 300675935, 1754909264, 3778377142, 45037864,
        2748513650, 3106305030, 3611142429, 16585439, 2463271477, 839065086, 2110090457,
        3285523277, 2671992121, 1449954761, 3010224752, 4188977562, 1628162929, 4236570725,
        2527706863, 4232285146, 3891805424, 2101334203, 1546360887, 620187625, 1599009804,
        1983556621, 2692805616, 3132580435, 3563152849, 890378510, 3152634851, 848218046,
        173110195, 1274899835, 2666420309, 812174750, 1268858730, 4185845575, 3874551118,
        2921042750, 4061658514, 4239038593, 1918666875, 2495488139, 3653027858, 812286746,
        331920115, 2474660633, 465786809, 823023149, 2944100376, 720684109, 3154724084, 184156130,
    ];

    crypto_sort_u32(&mut seed);

    assert_eq!(
        seed,
        [
            2343005761, 2411221485, 2463271477, 2474660633, 2495488139, 2501594143, 2527706863,
            2574438453, 2666420309, 2671992121, 2692805616, 2746176948, 2748513650, 2838386626,
            2907501882, 2921042750, 2944100376, 2988878015, 3009571896, 3010224752, 3017216762,
            3034284197, 3037598569, 3106305030, 3132580435, 3152634851, 3154724084, 3283210540,
            3285523277, 3469043655, 3470621498, 3498447549, 3563152849, 3595573699, 3611142429,
            3653027858, 3778377142, 3780371269, 3794103935, 3839796493, 3874551118, 3891805424,
            3915466775, 4017187193, 4061658514, 4142653423, 4185845575, 4188977562, 4213561102,
            4232285146, 4236570725, 4239038593, 16585439, 45037864, 138239789, 173110195,
            184156130, 300675935, 326114568, 331920115, 367884623, 440488066, 465786809, 607688268,
            620187625, 720684109, 732541564, 812174750, 812286746, 822844072, 823023149, 839065086,
            848218046, 890378510, 1011162928, 1035446042, 1052986081, 1075827061, 1186908429,
            1268858730, 1274899835, 1449954761, 1468014272, 1475375200, 1546360887, 1551077402,
            1571153962, 1585907552, 1599009804, 1628162929, 1702227250, 1754909264, 1757583649,
            1909929013, 1918666875, 1983556621, 2012121537, 2091507055, 2101334203, 2110090457,
        ]
    )
}

#[test]
fn test_crypto_sort_i32() {
    let mut seed: [i32; 100] = [
        -1089450670,
        -570481005,
        1972060672,
        -2019721882,
        -787012832,
        2017475379,
        -952165884,
        -1444932016,
        -1663161031,
        -1663526260,
        -938847662,
        235980194,
        -306595422,
        1665882290,
        884845824,
        1275682515,
        71549078,
        672956865,
        1019073228,
        1719137988,
        2023049622,
        -1305542398,
        -122355092,
        -1618414612,
        -1374620025,
        -372575048,
        -1867596245,
        -299054989,
        -1556277117,
        -2139890963,
        -2144519452,
        -1782856765,
        526078388,
        1277360924,
        -158316968,
        -169977410,
        -1343661699,
        1796831836,
        -2077955420,
        1961673633,
        201660139,
        112541812,
        1627682387,
        -965047933,
        1917176985,
        2046505740,
        -1074763314,
        548680622,
        -1402168437,
        488935271,
        -1209812833,
        -532023805,
        -260201770,
        663148257,
        -168359181,
        -1391600404,
        -2101218828,
        1230180439,
        1811487057,
        -742214047,
        -215961360,
        -1471018873,
        97026779,
        655227708,
        -648283125,
        -1319263871,
        1205954566,
        -481208104,
        -1687759848,
        181255624,
        1779690387,
        -2034855712,
        1384360178,
        -1346905315,
        973287907,
        1471974172,
        755697217,
        -1967242225,
        1902726773,
        -236589196,
        -1124011733,
        -419272812,
        1397700135,
        -1318652469,
        -1743582035,
        1636255889,
        -1246531495,
        -1315739004,
        1750865221,
        86207279,
        278779199,
        85004661,
        1587665664,
        -77588311,
        520475674,
        414914972,
        128966103,
        643364965,
        -1047270247,
        1655524610,
    ];

    crypto_sort_i32(&mut seed);

    assert_eq!(
        seed,
        [
            -2144519452,
            -2139890963,
            -2101218828,
            -2077955420,
            -2034855712,
            -2019721882,
            -1967242225,
            -1867596245,
            -1782856765,
            -1743582035,
            -1687759848,
            -1663526260,
            -1663161031,
            -1618414612,
            -1556277117,
            -1471018873,
            -1444932016,
            -1402168437,
            -1391600404,
            -1374620025,
            -1346905315,
            -1343661699,
            -1319263871,
            -1318652469,
            -1315739004,
            -1305542398,
            -1246531495,
            -1209812833,
            -1124011733,
            -1089450670,
            -1074763314,
            -1047270247,
            -965047933,
            -952165884,
            -938847662,
            -787012832,
            -742214047,
            -648283125,
            -570481005,
            -532023805,
            -481208104,
            -419272812,
            -372575048,
            -306595422,
            -299054989,
            -260201770,
            -236589196,
            -215961360,
            -169977410,
            -168359181,
            -158316968,
            -122355092,
            -77588311,
            71549078,
            85004661,
            86207279,
            97026779,
            112541812,
            128966103,
            181255624,
            201660139,
            235980194,
            278779199,
            414914972,
            488935271,
            520475674,
            526078388,
            548680622,
            643364965,
            655227708,
            663148257,
            672956865,
            755697217,
            884845824,
            973287907,
            1019073228,
            1205954566,
            1230180439,
            1275682515,
            1277360924,
            1384360178,
            1397700135,
            1471974172,
            1587665664,
            1627682387,
            1636255889,
            1655524610,
            1665882290,
            1719137988,
            1750865221,
            1779690387,
            1796831836,
            1811487057,
            1902726773,
            1917176985,
            1961673633,
            1972060672,
            2017475379,
            2023049622,
            2046505740,
        ]
    );
}
